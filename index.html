<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>GPS Tracker + ‡πÄ‡∏™‡∏≤‡πÑ‡∏ü (SP/HM + ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height: 100%; margin: 0; padding: 0; font-family: "Segoe UI", Tahoma, sans-serif; background: #f5f6fa; }
    #map { height: 100vh; width: 100%; z-index: 1; }

    /* üîΩ ‡∏Ç‡∏¢‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ã‡∏π‡∏°‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 3cm */
    .leaflet-top.leaflet-left { top: 30px !important; }

    .track-btn, .refresh-btn {
      position: fixed; top: 15px;
      padding: 10px 14px; border-radius: 8px; border: none;
      color: white; font-weight: bold; cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25); z-index: 2000;
    }
    .track-btn { left: 15px; background: #28a745; }
    .track-btn.stop { background: #dc3545; }
    .refresh-btn { right: 15px; background: #007bff; }
    .refresh-btn:hover { background: #0056b3; }

    .status-bar {
      position: fixed; bottom: 10px; left: 10px;
      background: rgba(255,255,255,0.95);
      padding: 10px 14px; border-radius: 10px;
      font-size: 14px; box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      z-index: 1000; line-height: 1.4; max-width: 90%;
    }

    .toast {
      position: fixed; top: 20px; right: 20px;
      background: #333; color: white;
      padding: 12px 20px; border-radius: 6px;
      font-size: 14px; opacity: 0;
      transition: opacity 0.5s, transform 0.3s;
      z-index: 3000; transform: translateY(-20px);
    }
    .toast.show { opacity: 1; transform: translateY(0); }

    .leaflet-div-icon { background: transparent !important; border: none !important; }
  </style>
</head>
<body>
  <button id="trackBtn" class="track-btn">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</button>
  <button id="refreshBtn" class="refresh-btn">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
  <div id="map"></div>
  <div id="status" class="status-bar">üïì ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà...</div>
  <div id="toast" class="toast"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    window.onload = () => {
      const map = L.map('map').setView([13.736717, 100.523186], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

      const trackBtn = document.getElementById("trackBtn");
      const refreshBtn = document.getElementById("refreshBtn");
      const statusEl = document.getElementById("status");
      const toast = document.getElementById("toast");

      let userMarker=null,userCircle=null,userPolyline=null,userPath=[];
      let watchID=null,isZoomedIn=false;

      function showToast(msg, type="info") {
        toast.textContent = msg;
        toast.style.background = type === "success" ? "#28a745" :
                                 type === "error" ? "#dc3545" : "#333";
        toast.classList.add("show");
        setTimeout(()=>toast.classList.remove("show"),3000);
      }

      function checkNearbyMarkers(lat, lng) {
        // (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ marker ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ä‡πâ map.distance() ‡∏ï‡∏£‡∏ß‡∏à)
      }

      // ‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠
      function enterFullscreen() {
        const el = document.documentElement;
        if (el.requestFullscreen) el.requestFullscreen();
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        else if (el.msRequestFullscreen) el.msRequestFullscreen();
      }

      // ‚ùé ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠
      function exitFullscreen() {
        if (document.exitFullscreen) document.exitFullscreen();
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        else if (document.msExitFullscreen) document.msExitFullscreen();
      }

      function startTracking() {
        if (watchID) return;
        showToast("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß", "success");
        trackBtn.textContent = "‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°";
        trackBtn.classList.add("stop");

        // üî∂ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å fullscreen ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡πÉ‡∏ô user gesture event)
        enterFullscreen();

        watchID = navigator.geolocation.watchPosition(pos=>{
          const {latitude,longitude,accuracy}=pos.coords;
          if(userMarker) map.removeLayer(userMarker);
          if(userCircle) map.removeLayer(userCircle);
          userMarker=L.marker([latitude,longitude],{icon:L.divIcon({html:"üìç"})}).addTo(map);
          userCircle=L.circle([latitude,longitude],{radius:accuracy}).addTo(map);
          userPath.push([latitude,longitude]);
          if(userPolyline) map.removeLayer(userPolyline);
          userPolyline=L.polyline(userPath,{color:"#007bff",weight:4}).addTo(map);
          map.setView([latitude,longitude],17);
          checkNearbyMarkers(latitude,longitude);
          statusEl.innerHTML=`üìç ${latitude.toFixed(5)},${longitude.toFixed(5)} (¬±${accuracy.toFixed(1)} m)`;
        },()=>showToast("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ!","error"),{enableHighAccuracy:true});
      }

      function stopTracking() {
        if(!watchID)return;
        navigator.geolocation.clearWatch(watchID);
        watchID=null;
        trackBtn.textContent="‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°";
        trackBtn.classList.remove("stop");
        showToast("üõë ‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß","info");

        // ‚ùé ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å fullscreen
        exitFullscreen();
      }

      trackBtn.onclick=()=>{ if(watchID) stopTracking(); else startTracking(); };
      refreshBtn.onclick=()=>showToast("üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)","info");
    };
  </script>
</body>
</html>
