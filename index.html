function createPopup(marker, name, status, color) {
  const div = document.createElement("div");
  div.innerHTML = `
    <b>${name}</b><br>
    ðŸ”° <b id="statusText" style="color:${color}">${status || "-"}</b><br><br>
    <div class="btn-row">
      <button class="btn btn-green" id="onA">à¹„à¸Ÿà¸•à¸´à¸” A</button>
      <button class="btn btn-green" id="onB">à¹„à¸Ÿà¸•à¸´à¸” B</button>
      <button class="btn btn-green" id="onAB">à¹„à¸Ÿà¸•à¸´à¸” AB</button>
      <button class="btn btn-red" id="offA">à¹„à¸Ÿà¸”à¸±à¸š A</button>
      <button class="btn btn-red" id="offB">à¹„à¸Ÿà¸”à¸±à¸š B</button>
      <button class="btn btn-red" id="offAB">à¹„à¸Ÿà¸”à¸±à¸š AB</button>
    </div>
  `;
  const popup = L.popup().setContent(div);
  marker.bindPopup(popup);

  marker.on("popupopen", () => {
    const statusEl = div.querySelector("#statusText");

    function updateStatus(newStatus) {
      const newColor = colorForStatus(newStatus);
      statusEl.style.color = newColor;
      statusEl.textContent = newStatus;
      sendStatusToSheet(name, newStatus);
    }

    document.getElementById("onA").onclick = () => updateStatus("à¹„à¸Ÿà¸•à¸´à¸”A");
    document.getElementById("onB").onclick = () => updateStatus("à¹„à¸Ÿà¸•à¸´à¸”B");
    document.getElementById("onAB").onclick = () => updateStatus("à¹„à¸Ÿà¸•à¸´à¸”AB");
    document.getElementById("offA").onclick = () => updateStatus("à¹„à¸Ÿà¸”à¸±à¸šA");
    document.getElementById("offB").onclick = () => updateStatus("à¹„à¸Ÿà¸”à¸±à¸šB");
    document.getElementById("offAB").onclick = () => updateStatus("à¹„à¸Ÿà¸”à¸±à¸šAB");
  });
}
